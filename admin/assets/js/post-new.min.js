;(function($){"use strict";var preloader=$('<p class="preloader" style="text-align:center;"><img src="/wp-admin/images/spinner.gif"/></p>');var slideCopy=null;$(document).on('click','input.choose-template',function(){$('input#new-template').val($(this).data('slug'));return true;});$(document).on('submit','form#post',function(ev){if(!$('input#new-template').length){$('form#post').trigger('cnhkSavePost');if($(this).data('canSave')){return true;}else{ev.preventDefault();$('#submitdiv .spinner').remove();$('#submitdiv').find('button,input[type="submit"]').removeClass('disabled');return false;}}});$(document).on('change','select.with-tip',function(ev){var tip=$(this).find('option:selected').data('tip');if(undefined==tip){tip='';};var target=$(this).siblings('.desc').find('.select-tip');target.html(tip);});$(document).on('click','.remove-slide',function(ev){ev.stopPropagation();$(this).parents('.slide').hide(200,function(){$(this).remove();})});$(document).on('click','#add-slide',function(ev){ev.preventDefault();ev.stopPropagation();if(''==$('#new-slide-type').val())return;$('#slides-list').append(preloader.clone());var formData={nonce:cnhkAjaxNonce,type:$('#new-slide-type').val(),action:'cnhk_add_slide',template:$('input[name="template"]').val(),};if(slideCopy){formData['type']=slideCopy.type;formData['copy-id']=slideCopy.id;var slideDiv=$('.slide-id[value="'+slideCopy.id+'"]').parents('.slide');slideDiv.find('input,select,textarea').each(function(){if($(this).attr('name')){if('CHECKBOX$'==$(this).prop('tagName')){if(!$(this).prop('checked'))return;};formData[$(this).attr('name')]=$(this).val();}});slideCopy=null;};$.ajax({type:'POST',url:ajaxurl,data:formData,success:function(data,textStatus,XMLHttpRequest){$('.preloader').remove();var slide=$(data);var index=($('#slides-list .slide').length);$('#slides-list').append(slide);$('#slides-list').trigger('slideAdded',[slide,index]);},error:function(MLHttpRequest,textStatus,errorThrown){$('.preloader').remove();}});});$(document).on('click','.duplicate-slide',function(ev){ev.stopPropagation();ev.preventDefault();slideCopy={};var type=$(this).parents('.slide').find('.slide-type').val();if($('#new-slide-type option[value="'+type+'"]').length){$('#new-slide-type').val(type);slideCopy.id=$(this).parents('.slide').find('.slide-id').val();slideCopy.type=type;$('#add-slide').trigger('click');}});$(document).on('click','.preview-slide',function(ev){var id=$(this).parents('.slide').find('.slide-id').val();var tH=cnhkTemplateHandler[$('input[name="template"]').val()];tH.previewSingleSlide(id);});$(document).on('slideAdded','#slides-list',function(ev,slide,index){$('#slides-list').accordion('refresh').accordion('option','active',index);slide.find('.slide-params').each(function(){$(this).accordion({header:' .param-header',collapsible:false,heightStyle:'content',active:0,});});if(slide.find('.fx-autopicker').length){var picker=slide.find('.fx-autopicker');var pickerOptions={root:picker.attr('data-root'),code:picker.val(),};if(picker.siblings('.fx-autosaver').length){var autosaver=picker.siblings('.fx-autosaver');autosaver.cnhkFxSaver({root:autosaver.attr('data-root'),codeElem:picker,autoRemove:true,});pickerOptions['saverElem']=autosaver;};picker.cnhkFxPicker(pickerOptions);}});$(window).resize(function(){$('td.slide-preview .slide-main-content').each(function(){var data=$(this).data('cnhkSlideWrap');if(data&&$(this).parents('.slide-inside').hasClass('ui-accordion-content-active')){data.scale();}});});$(document).on('click','#preview-slideshow',function(ev){ev.preventDefault();if($('#cnhkss-slides-param .slide').length){$(document).trigger('beforeSliderPreview');var tH=cnhkTemplateHandler[$('input[name="template"]').val()];tH.previewSlideshow();}});function checkBoxingState(){if($('#boxed-inputs-alt').length){if($('#options-b').prop('checked')){$('#boxed-inputs-alt input').attr('disabled','disabled');$('#boxed-inputs').find('input,select').removeAttr('disabled');}else{$('#boxed-inputs-alt input').removeAttr('disabled');$('#boxed-inputs').find('input,select').attr('disabled','disabled');}}else{return false;}};$(document).on('click','#options-b',function(){checkBoxingState();});function checkSliderBg(){if($('#slider-bg-src').val()){$('#slider-bg-inputs-alt input').attr('disabled','disabled');$('#slider-bg-inputs').find('input,select').removeAttr('disabled');$('#clear-slider-bg').removeAttr('disabled');}else{$('#slider-bg-inputs-alt input').removeAttr('disabled');$('#slider-bg-inputs').find('input,select').attr('disabled','disabled');$('#clear-slider-bg').attr('disabled','disabled');}};$(document).on('change','#slider-bg-src',function(){checkSliderBg()});$(document).on('click','#select-slider-bg',function(ev){ev.preventDefault();$.cnhkImageFrame({url:$('#slider-bg-src'),mime:['image/jpeg','image/png'],notice:$('#slider-bg-notice'),});});$(document).on('click','#clear-slider-bg',function(ev){ev.preventDefault();$('#slider-bg-src').val('');$(this).prop('disabled',true);});$(document).on('change','.slide-name',function(){if(($(this).val())){$(this).parents('.slide').find('.slide-name-head').text($(this).val());}else{$(this).parents('.slide').find('.slide-name-head').html('&nbsp;');}});$(document).on('change','.caption-name',function(){if(($(this).val())){$(this).parents('.caption').find('.caption-name-head').text($(this).val());}else{$(this).parents('.caption').find('.caption-name-head').html('&nbsp;');}});$(document).on('change','.layer-name',function(){if(($(this).val())){$(this).parents('.layer').find('.layer-name-head').text($(this).val());}else{$(this).parents('.layer').find('.layer-name-head').html('&nbsp;');}});$(function(){$('#visibility').hide();$('.color-picker').wpColorPicker();checkBoxingState();checkSliderBg();if($('input[name="template"]').length){$('#save-action').prepend('<button class="button-secondary" id="preview-slideshow">'+mainScriptLocale.preview+'</button>');}else{$('#save-post,#publish').attr('disabled','disabled');};$('#slides-list').sortable({items:' .slide',handle:' .dashicons-sort',stop:function(ev,ui){$('#slides-list').trigger('stopSorting',ui);},});$('#slides-list').accordion({header:' .slide-header',collapsible:true,heightStyle:'content',active:false,activate:function(ev,ui){$('#slides-list').trigger('activate',ui);},beforeActivate:function(ev,ui){$('#slides-list').trigger('beforeActivate',ui);}});$('.slide-params').accordion({header:' .param-header',collapsible:false,heightStyle:'content',active:0,activate:function(ev,ui){if(ui.oldPanel.length){var slideId=ui.oldPanel.parents('.slide').find('.slide-id').val();$('.slide').has('.slide-id[value="'+slideId+'"]').trigger('paramDeactivate',ui);}},});$('.fx-autopicker').each(function(){var pickerOptions={root:$(this).attr('data-root'),code:$(this).val(),};if($(this).siblings('.fx-autosaver').length){var autosaver=$(this).siblings('.fx-autosaver');autosaver.cnhkFxSaver({root:autosaver.attr('data-root'),codeElem:$(this),autoRemove:true,});pickerOptions['saverElem']=autosaver;};$(this).cnhkFxPicker(pickerOptions);});$('form#post').data('canSave',true);});})(jQuery);